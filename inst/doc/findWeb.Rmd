---
title: "findWeb"
author: "Sigbert Ingress (sigbert.ingress@gmail.com)"
date: "15 August 2018"
output: 
  html_document:
    toc: true
vignette: >
  %\VignetteIndexEntry{Put the title of your vignette here}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## An artifical example 

In this example we will create for a set of thirty portals a [fishbone (or herringbone)](https://www.youtube.com/watch?v=FkHtelZxgtg) linking structure. 

```{r, echo = FALSE, fig.width = 7, fig.height = 7}
  library("findWeb")
  g <- fishbone(8)
  plot(g)
```

The fishbone(8) structure consists of nine portals, twentyone links and 19 fields. It was one of the popular linking structures since the EXO5 Controller event in October 2017 since it is simple. And in any case no Softbank Ultra Link is necessary to build it.  

### Step 1: Create a portal positions and web

At first we need to generate some x-y-coordinates for portals

```{r createportal}
  library("findWeb")
  set.seed(1)
  n  <- 20
  xy <- cbind(runif(n), runif(n))
  xy
```

and then we need to create a target link structure (or web), here the fishbone(6)

```{r}
  g <- fishbone(6)
  plot(g)
```

Note: the random seed needs to be fixed since the portal positions are generated randomly and the optimization algorithm uses a random search.

### Step 2: Create an initial link structure

Then we have to create a starting link structure.

```{r, fig.width = 7, fig.height = 7}
  g0 <- web(g, xy)
  plot(g0)
```

There are two requirements for a perfect link structure:

* there should be no intersections between links and
* the number of portals inside a field should be larger than in the target linking structure.

The second condition means that for the fishbone(n) the largest field should contain at least n-2 portals. The error value used is the number of link intersections plus number of portals for each field missing to the target link structure. 

### Step 3: Optimize the link structure by program

The next step is an optimization of the start link structure. The optimizeWeb generates two (at start and end) or even more plots.

```{r, fig.width = 7, fig.height = 7}
  g1 <- optimizeWeb(g0)
```

In this case the optmization algorithm has found a solution with no errors. It is not guranteed that the program will find a link structure with no errors!

Since the a random search algorithm is used you may repeat the search several times and may become a different solution. 

```{r}
  g11 <- optimizeWeb(g0)
```

### Step 4: Optimize the link structure by hand

However, the solution the program found is not optimal: the outer portals are far away from each other. 

```{r echo=FALSE}
g2 <- swap(g1, c(18,12), c(4,19))
```

```{r eval=FALSE}
  g2 <- swapi(g1)  # swap 18-4, 12-19
  plot(g2)
```

```{r, , fig.width = 7, fig.height = 7, echo=FALSE}
  plot(g2)
```

## A real-world example

Part of the package is a data set about portals in the Leisepark in Berlin, Germany ([Ingress intel map](https://www.ingress.com/intel?ll=52.529436,13.422475&z=17)).

```{r}
  library("findWeb")
  data(leisepark)
  head(leisepark)
```

Convert the latitudes and longitudes to xy-coordinates

```{r}
  xy <- ll2xy(leisepark$lon, leisepark$lat)
  head(xy)
```

Let us create now as target link structure a homogeneous field of order four.

```{r, fig.width = 7, fig.height = 7}
  g <- homogeneous(4)
  plot(g)
```

Apply the real-world portal positions to the target link structure

```{r, fig.width = 7, fig.height = 7}
  g0 <- web(g, xy)
  plot(g0)
```

Now optimize the positions

```{r, fig.width = 7, fig.height = 7}
  g1 <- optimizeWeb(g0)
```

There are still some portals inside in the link structure which are not used. Maybe the link structure can be made more compact (=shorter ways for our agents) which could be achieved by hand optimization.

```{r eval=FALSE}
  g2 <- swapi(g1)
```

[__Enjoy planing and linking, agents!__](https://plus.google.com/collection/wlnaV)

## Thanks ##

Finally, a thanks to Stefan Dirsch for testing the R package ;)